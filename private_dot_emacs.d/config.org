# -*- eval: (display-line-numbers-mode); -*-
#+STARTUP: overview hidestars
#+PROPERTY: header-args :results silent :tangle yes

* Packages management
Initialize built-in package manager and =use package=
#+begin_src emacs-lisp
  (require 'package)
#+end_src

** Initialize MELPA
#+begin_src emacs-lisp
  (add-to-list
    'package-archives '("melpa" . "https://melpa.org/packages/"))
#+end_src

** use-package
use-package and use-package-ensure
#+begin_src emacs-lisp
  (eval-when-compile
    (require 'use-package))
  (require 'use-package-ensure)
#+end_src

* Bare minimum
** [[https://github.com/emacs-evil/evil][Evil]] mode
Install and enable evil mode and use undo-tree
#+begin_src emacs-lisp
  (use-package undo-tree
    :ensure t
    :config
    (global-undo-tree-mode))

  (use-package evil
    :ensure t
    :config
    (evil-mode 1)
    (evil-set-undo-system 'undo-tree))
#+end_src

** Line numbering
#+begin_src emacs-lisp
  (global-display-line-numbers-mode)
#+end_src

** Column 80 ruler
Use this as a soft boundary for when writing code
#+begin_src emacs-lisp
  (setq display-fill-column-indicator-column 80)
  (global-display-fill-column-indicator-mode)
#+end_src

** Global keybindings
*** emacs config
Quick open emacs config file
#+begin_src emacs-lisp
  (defun org-config ()
    "Open the default org config file"
    (interactive)
    (find-file "~/.emacs.d/config.org"))
#+end_src

open =config.org= (this file) whith =C-c c=

#+begin_src emacs-lisp
  (keymap-global-set "C-c c" 'org-config)
#+end_src

*** Better resize keys 
#+begin_src emacs-lisp
  (keymap-global-set "C-S-<left>"  'shrink-window-horizontally)
  (keymap-global-set "C-S-<right>" 'enlarge-window-horizontally)
  (keymap-global-set "C-S-<down>"  'shrink-window)
  (keymap-global-set "C-S-<up>"    'enlarge-window)
#+end_src

** Org agenda
Quick open agenda main file and agenda-view menu
#+begin_src emacs-lisp
  (keymap-global-set "C-c a" 'org-agenda)
  (keymap-global-set "C-c s" (find-file "~/org/agenda/index.org"))
#+end_src

#+begin_src emacs-lisp
  (setq org-agenda-files '("~/org/agenda"))
#+end_src

Agenda directory missing results in errors then I will ensure the
directory exists
#+begin_src emacs-lisp
  (let ((agenda-file (car org-agenda-files)))
    (if (not (file-exists-p agenda-file))
             (make-directory agenda-file)))
#+end_src

* Style
** Catpuccin
Just like this theme and I use it almost system-wide
#+begin_src emacs-lisp
  (use-package catppuccin-theme
    :ensure t)
  (setq catpuccin-flavor 'mocha)
  (load-theme 'catppuccin :no-confirm)
#+end_src

** Use spaces for indentation
#+begin_src emacs-lisp
  (set-default 'indent-tabs-mode nil)
#+end_src

* Packages
** suggestions & completion
*** company
#+begin_src emacs-lisp
  (use-package company
    :ensure t
    :hook
    (after-init . global-company-mode)
    :custom
    ;; such config, much I understand nothing
    (company-minimum-prefix-length 2) ;; suggestion after 2 characters
    (company-idle-delay 0.0)          ;; no delay in company pop-up
    (company-selection-wrap-around t) ;; wrap around menu
    (company-show-numbers t)
    (company-require-match nil)
    (company-dabbrev-downcase nil)
    :bind
    (:map company-active-map
          ("C-n". company-select-next)
          ("C-p". company-select-previous)
          ("M-<". company-select-first)
          ("M->". company-select-last)))
#+end_src

*** YASnippet
Useful snippets to avoid writing too much
#+begin_src emacs-lisp
  (use-package yasnippet-snippets
    :ensure t)
#+end_src

#+begin_src emacs-lisp
  (use-package yasnippet
    :ensure t
    :after (yasnippet-snippets)
    :config
    (yas-reload-all)
    (yas-global-mode)
    ;; Set snippets folder
    (add-to-list 'yas-snippet-dirs "~/.emacs.d/snippets")
    ;; Run yasnippet in both text and prog mode
    :hook
    (prog-mode-hook . yas-minor-mode)
    (text-mode-hook . yas-minor-mode)) 
#+end_src

*** flyspell
#+begin_src emacs-lisp
  (add-hook 'text-mode-hook 'flyspell-mode)
  (add-hook 'prog-mode-hook 'flyspell-prog-mode)
#+end_src

*** flycheck
#+begin_src emacs-lisp
  (use-package flycheck
    :ensure t)
#+end_src

** which-key
I have a REALLY bad memory
#+begin_src emacs-lisp
  (use-package which-key
    :ensure t
    :config
    (which-key-mode))
#+end_src
** vertico
Better search
#+begin_src emacs-lisp
  (use-package vertico
    :ensure t
    :init
    (vertico-mode))
#+end_src

** lsp-mode
#+begin_src emacs-lisp :tangle no
  (use-package lsp-mode
    :ensure nil
    :commands lsp
    :custom
#+end_src

=rust-analyzer= for lsp-mode
#+begin_src emacs-lisp :tangle no
  ;; what to use when checking on-save. "check" is default, I prefer clippy
  (lsp-rust-analyzer-cargo-watch-command "clippy")
  (lsp-eldoc-render-all t)
  (lsp-idle-delay 0.6)
  ;; enable / disable the hints as you prefer:
  (lsp-inlay-hint-enable t)
  ;; These are optional configurations. See https://emacs-lsp.github.io/lsp-mode/page/lsp-rust-analyzer/#lsp-rust-analyzer-display-chaining-hints for a full list
  (lsp-rust-analyzer-display-lifetime-elision-hints-enable "skip_trivial")
  (lsp-rust-analyzer-display-chaining-hints t)
  (lsp-rust-analyzer-display-lifetime-elision-hints-use-parameter-names nil)
  (lsp-rust-analyzer-display-closure-return-type-hints t)
  (lsp-rust-analyzer-display-parameter-hints nil)
  (lsp-rust-analyzer-display-reborrow-hints nil) 
 #+end_src
 
 use =lsp-ui=
 #+begin_src emacs-lisp :tangle no
  :hook
  (lsp-mode-hook . lsp-ui-mode))
#+end_src

** lsp-ui
Inline lsp overlay
#+begin_src emacs-lisp
  (use-package lsp-ui
    :ensure nil
    :commands lsp-ui-mode
    :custom
    (lsp-ui-peek-always-show t)
    (lsp-ui-sideline-show-hover t)
    (lsp-ui-doc-enable nil))
#+end_src

** Modes
*** rust-mode
#+begin_src emacs-lisp :tangle no
  (use-package rust-mode
    :ensure nil)
#+end_src

*** markdown-mode
#+begin_src emacs-lisp
  (use-package markdown-mode
    :ensure t
    :config
    (add-to-list
      'auto-mode-alist
      '("\\.md\\'" . markdown-mode)))
#+end_src
